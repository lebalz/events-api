//// ------------------------------------------------------
//// THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
//// ------------------------------------------------------

Table users {
  id String [pk]
  email String [unique, not null]
  untis untis_teachers
  untisId Int [unique]
  firstName String [not null]
  lastName String [not null]
  role Role [not null, default: 'USER']
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [default: `now()`, not null]
  events events [not null]
  icsLocator String
  jobs jobs [not null]
  eventGroups user_event_groups [not null]
}

Table events {
  id String [pk]
  author users [not null]
  authorId String [not null]
  start DateTime [not null]
  end DateTime [not null]
  location String [not null, default: '']
  description String [not null, default: '']
  descriptionLong String [not null, default: '']
  state EventState [not null, default: 'DRAFT']
  cloned Boolean [not null, default: false]
  job jobs
  jobId String
  parent events
  parentId String
  children events [not null]
  userGroup user_event_groups
  userGroupId String
  classes String[] [not null]
  classGroups String[] [not null]
  departments departments [not null]
  audience EventAudience [not null, default: 'STUDENTS']
  teachingAffected TeachingAffected [not null, default: 'YES']
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [default: `now()`, not null]
  deletedAt DateTime
}

Table user_event_groups {
  id String [pk]
  name String [not null, default: '']
  description String [not null, default: '']
  user users [not null]
  userId String [not null]
  events events [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [default: `now()`, not null]
}

Table departments {
  id String [pk]
  name String [unique, not null]
  description String [not null, default: '']
  letter String [not null, default: '']
  classLetters String[] [not null]
  classes untis_classes [not null]
  events events [not null]
  color String [not null, default: '#306cce']
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [default: `now()`, not null]
}

Table semesters {
  id String [pk]
  name String [not null]
  start DateTime [not null]
  end DateTime [not null]
  untisSyncDate DateTime [not null]
  lessons untis_lessons [not null]
  jobs jobs [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [default: `now()`, not null]
}

Table registration_periods {
  id String [pk]
  name String [not null]
  start DateTime [not null]
  end DateTime [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [default: `now()`, not null]
}

Table jobs {
  id String [pk]
  type JobType [not null]
  state JobState [not null, default: 'PENDING']
  user users [not null]
  userId String [not null]
  semester semesters
  semesterId String
  syncDate DateTime
  events events [not null]
  description String [not null, default: '']
  filename String
  log String [not null, default: '']
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [default: `now()`, not null]
}

Table untis_teachers {
  id Int [pk, increment]
  name String [unique, not null]
  longName String [not null]
  title String [not null]
  active Boolean [not null]
  lessons untis_lessons [not null]
  classes untis_classes [not null]
  user users
}

Table untis_lessons {
  id Int [pk, increment]
  room String [not null]
  subject String [not null]
  description String [not null]
  semesterNr Int [not null]
  year Int [not null]
  weekDay Int [not null]
  startHHMM Int [not null]
  endHHMM Int [not null]
  classes untis_classes [not null]
  teachers untis_teachers [not null]
  semester semesters [not null]
  semesterId String [not null]
}

Table untis_classes {
  id Int [pk, increment]
  name String [unique, not null]
  legacyName String [unique]
  year Int [not null]
  sf String [not null]
  lessons untis_lessons [not null]
  teachers untis_teachers [not null]
  department departments
  departmentId String
}

Table session {
  sid String [pk]
  sess Json [not null]
  expire DateTime [not null]
}

Table view__users_teaching {
  userId String [not null]
  userEmail String [not null]
  classId Int [not null]
  className String [not null]
  classNameLegacy String [not null]
  lessonId Int [not null]
  lessonSubject String [not null]
  lessonStartHHMM Int [not null]
  lessonEndHHMM Int [not null]
  lessonWeekDay Int [not null]
  lessonSemesterId String [not null]
  departmentId String [not null]
  departmentName String [not null]
  klp String
  klpDepartmentId String
  untis_teacher_id Int

  indexes {
    (userId, classId, lessonId, departmentId) [unique]
  }
}

Table view__events {
  eventId String [not null]
  start DateTime [not null]
  end DateTime [not null]
  state EventState [not null]
  classes String[] [not null]
  description String [not null]
  class_groups String[] [not null]
  audience EventAudience [not null]
  department_ids String[] [not null]
  yearStart Decimal [not null]
  yearEnd Decimal [not null]
  startWeekDay Decimal [not null]
  endWeekDay Decimal [not null]
  startOffset_m Decimal [not null]
  endOffset_m Decimal [not null]
  duration_m Decimal [not null]
  semesterId String [not null]

  indexes {
    (eventId, semesterId) [unique]
  }
}

Table view__users_teaching_agg {
  uId String [not null]
  lSemesterId String [unique, not null]
  classIds Int[] [not null]
  classNames String[] [not null]
  legacyClassNames String[] [not null]
  subjects String[] [not null]
  departmentIds String[] [not null]
  departmentNames String[] [not null]
}

Table view__affected_by_events {
  userId String [not null]
  eventId String [not null]
  semesterId String [not null]
  classId Int [not null]
  lessonId Int [not null]

  indexes {
    (userId, eventId, semesterId, classId, lessonId) [unique]
  }
}

Table view__users_affected_by_events {
  userId String [not null]
  semesterId String [not null]
  id String [pk]
  authorId String [not null]
  start DateTime [not null]
  end DateTime [not null]
  location String [not null]
  description String [not null]
  descriptionLong String [not null]
  state EventState [not null, default: 'DRAFT']
  cloned Boolean [not null, default: false]
  jobId String
  parentId String
  userGroupId String
  classes String[] [not null]
  classGroups String[] [not null]
  audience EventAudience [not null, default: 'STUDENTS']
  teachingAffected TeachingAffected [not null, default: 'YES']
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [default: `now()`, not null]
  deletedAt DateTime

  indexes {
    (id, userId, semesterId) [unique]
  }
}

Table view__lessons_affected_by_events {
  eventId String [not null]
  semesterId String [not null]
  id Int [pk]
  room String [not null]
  subject String [not null]
  description String [not null]
  semesterNr Int [not null]
  year Int [not null]
  weekDay Int [not null]
  startHHMM Int [not null]
  endHHMM Int [not null]
  teacherIds Int[] [not null]
  classIds Int[] [not null]

  indexes {
    (id, eventId, semesterId) [unique]
  }
}

Enum Role {
  USER
  ADMIN
}

Enum EventState {
  DRAFT
  REVIEW
  PUBLISHED
  REFUSED
}

Enum TeachingAffected {
  YES
  PARTIAL
  NO
}

Enum JobState {
  PENDING
  ERROR
  DONE
  REVERTED
}

Enum JobType {
  IMPORT
  CLONE
  SYNC_UNTIS
}

Enum EventAudience {
  LP
  KLP
  STUDENTS
  ALL
}

Ref: users.untisId - untis_teachers.id

Ref: events.authorId > users.id

Ref: events.jobId > jobs.id [delete: Cascade]

Ref: events.parentId - events.id [delete: Cascade]

Ref: events.userGroupId > user_event_groups.id

Ref: user_event_groups.userId > users.id [delete: Cascade]

Ref: jobs.userId > users.id [delete: Cascade]

Ref: jobs.semesterId > semesters.id

Ref: untis_lessons.semesterId > semesters.id [delete: Cascade]

Ref: untis_classes.departmentId > departments.id